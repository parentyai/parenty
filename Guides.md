## Guides（派生参照導線：統合）

## 派生文書共通宣言（固定）

- 本書は定義文書ではない。
- 本書は仕様の正・権威を持たない。
- Policy / UX / 権限 / 判定の正は SSOT および `PolicyUxAdminMatrix.md` にのみ存在する。
- 本書の記述が SSOT / Matrix と矛盾した場合、常に SSOT / Matrix が優先される。
- 本書の「例」「列挙」「手順」は実装・仕様のテンプレではない。
- 本書を根拠に Policy / UX / 権限 / 判定を変更してはならない。

本書単体で仕様判断してはならず、判断起点は PolicyUxAdminMatrix にあり、SSOT/Matrix が常に優先される。
## メタ（固定）

- **SSoT責務**: 既存の派生ガイド（Architecture/DecisionFlow/DataContract/PolicyEngine/UX/AdminUI/ReasonCodes/Roadmap/Productization）の **参照導線を1箇所に統合**し、SSOT逸脱とファイル増殖を防ぐ。
- **想定読者**: CTO(GPT) / Engineer(Cursor) / Ops
- **依存SSoT**: `PARENTY_SSOT.md`（2章/3章/4章/5章/6章/7章/1-4-3/1-4-3-A/付録B/C）
- **生成物**: “迷ったときに戻る”参照導線（派生の複製を作らない）
- **編集禁止領域**:
  - SSOTに無い概念/enum/状態/運用概念の本文追加
  - 付録C（DEGRADED/DENY文言）の創作
  - reasonCode/nextAction/templateId/collection/field の独自追加
- **更新ルール**:
  - 未確定・矛盾は本文に入れず、末尾の「矛盾候補（隔離）」へ集約し、`Todo.md` に記録して停止する。
  - 本ファイルは **参照導線**を主目的とし、SSOT内容の“列挙/複製”をしない。
- **変更履歴**:
  - 2026-01-08: 派生ガイド群を `Guides.md` に統合（CTO役AIの閲覧制約に合わせてファイル数最小化）
- **関連リンク**: `SSOT_INDEX.md` / `Glossary.md` / `PolicyUxAdminMatrix.md` / `Runbook.md` / `ImplementationPlan.md` / `Progress.md` / `Todo.md`

---

## 背景

- 派生ドキュメントが増えるほど、参照切れ・表記揺れ・DRAFT混入が起きやすく、SSOT逸脱の温床になる。
- CTO役AIの同時閲覧制約（タブ数）を前提に、**参照導線のファイル数を最小化**する。

---

## 説明

### 参照の正（SSOT）

- **最上位の正**: `PARENTY_SSOT.md`
- **参照体系/更新規約**: `SSOT_INDEX.md`

---

### レイヤー責務と判断一本化（旧: `Architecture.md`）

参照（正）: SSOT 2-1 / 2-2 / 2-3 / 6-0 / 6-2X / 6-2Y / 6-2Z / 7章

- **5層の責務**:
  - UX（入口）/ Policy Engine（中枢）/ Delivery（配送）/ Data（真実・証跡）/ Ops/Admin（統治）
- **固定規約**:
  - UXは判断しない
  - Policyは決定する唯一の主体
  - Deliveryは決定を変えない
  - Dataは証跡（監査可能性）
  - Opsは統治（人間介入の唯一の正規レイヤー）
- **禁止**:
  - 独自状態/独自運用概念/独自文言（付録C以外）
  - enum / reasonCode / templateId / nextAction の即興追加
- **不明点**:
  - 本文で設計判断せず、`Todo.md` に記録して停止

---

### Policy→nextAction→Runbook の決定フロー（旧: `DecisionFlow.md`）

参照（正）: SSOT 3章 / 6-2X / 6-2Y / 6-2Z / 7章 / 付録B/C

- **policyDecision 出力（固定）**:
  - `result`: ALLOW | DEGRADED | DENY
  - `reasonCodes[]`: min 1
  - `primaryReason`: 必須（配列内の1つ）
  - `templateId`: 任意（付録Cテンプレ使用時のみ）
  - `nextAction`: 任意（6-2Z 準拠）
- **nextAction 生成（固定）**:
  - 入力: `primaryReason` を起点に 6-2X の行へ
  - 一致なし: 6-2Y のフォールバック → それでも無ければ fail-safe
- **FAIL-SAFE**:
  - 未定義 reasonCode → `UNKNOWN_REASON` 正規化
  - `result = DENY` + `nextAction.action = CREATE_INCIDENT`

---

### データ契約（policyDecision / policyTrace / nextAction）（旧: `DataContract.md`）

参照（正）: SSOT 3-3-1 / 4章 / 6-2Z / 付録B/C

- **Firestore 共通埋め込み（必須）**:
  - `policyDecision`（notifications / notification_deliveries / faq_logs / scenario_states 等、SSOT準拠）
  - `policyTrace`（PII禁止の inputsDigest 等、SSOT準拠）
- **nullable/non-null（固定）**:
  - `policyDecision` 自体: non-null
  - `reasonCodes[]`: non-null, min1
  - `primaryReason`: non-null
  - `templateId`: nullable
  - `nextAction`: nullable（ただし object 内の `action` は non-null）
- **enum の正**:
  - ReasonCode は SSOT 付録B
  - NextActionType は SSOT 6-2Z

---

### Policy Engine（読み方の参照導線）（旧: `PolicyEngine.md`）

参照（正）: SSOT 3章 / 6-0 / 6-2X / 6-2Y / 6-2Z / 付録B/C

- **判定順序（固定）**: SSOT 3-B（判定入力と評価順序）
  - global_flags → households.flags → feature switches → plan → consent → risk → context/ops
- **policyDecision（固定）**: SSOT 3-3-1 / 付録B
  - 3値（ALLOW/DEGRADED/DENY）、reasonCodes min1、primaryReason必須
- **派生側の役割**:
  - SSOTへ戻るための参照導線のみ（複製しない）

---

### UX（状態別: ALLOW/DEGRADED/DENY）（旧: `UX.md`）

参照（正）: SSOT 5章 / 6-0 / 付録C / 1-3 / 1-4

- **ALLOW**: Policy結果の表示・受け渡しのみ（UXは判断しない）
- **DEGRADED/DENY**:
  - 沈黙禁止
  - 文言は付録Cのみ（創作禁止）
  - “できる/できない”の構造はSSOTへ戻す

---

### Admin UI（Policy可視化 + nextAction 実行）（旧: `AdminUI.md`）

参照（正）: SSOT 6章 / 6-0 / 6-2X / 6-2Y / 6-2Z / 7章

- 管理UIは常に **Policy結果を可視化**し、**nextActionに従って動く**（UIが解釈しない）
- 操作は監査ログ規約（append-only / 理由必須等）に従う（SSOTへ戻す）
- ダッシュボード集計は admin_views（派生）で行い、意思決定に使わない（SSOT 2-3）

#### SSOT拘束（MUST）

- テンプレ編集画面（作成/編集/公開状態変更）は、**適用SSOT条番号の指定が必須**。
- 即時停止 / 例外操作は、**対応するSSOT条番号の表示**と **reasonCode の明示**が必須。
- **SSOT未指定の操作は保存不可**（UIレベルでブロック。例外なし）。

---

### reasonCode 更新チェックリスト（旧: `ReasonCodes.md`）

参照（正）: SSOT 付録B / 6-0 / 6-2X / 6-2Z

- reasonCode の **正**は SSOT 付録B（派生で列挙しない）
- reasonCode を追加/変更/削除する場合の最低限:
  - 付録B（定義）
  - 6-0（カテゴリ別マトリクス）
  - 6-2X（primaryReason→nextAction、必要なら行追加）
  - 6-2Z（OpenAPI enum 拘束）

---

### Roadmap（仕様に混ぜないゲート）（旧: `Roadmap.md`）

参照（正）: `PARENTY_SSOT.md` / `ImplementationPlan.md` / `Progress.md` / `Todo.md`

- Roadmapは仕様の正ではない（本文で仕様追加しない）
- 案は隔離に置き、確定は SSOT 更新→承認→`Progress.md` 記録

---

### Productization（外部提供: 禁止維持のゲート）（旧: `Productization.md`）

参照（正）: SSOT 1-4 / 1-4-3 / 1-4-3-A / 7-3 / 8-4

- **現在の結論（固定）**: 生データ/集計値/再集計可能データの外部提供は禁止を維持（SSOT 1-4-3）
- Derived Insight の境界は SSOT 1-4-3-A を正として参照する

---

## UX品質判断メモ（非仕様・判断補助資料）

- 本セクションは仕様ではない。
- SSOT / PolicyUxAdminMatrix / UX_STATE_MAP_7 の定義・文言・意味を変更・補完しない。
- レビューおよび判断補助のみを目的とする。

① UX品質チェック観点表（レビュー用）
opener（最初の一文）
Pass: 判断主体がユーザー側に固定されている
Fail: AIが決めたと誤解される文言が含まれる
Pass: 事実と条件が分離されている
Fail: 根拠不明の断定が含まれる
Pass: 付録Cに依存する語句が直接書かれていない
Fail: DEGRADED/DENYの文言が独自に生成されている

本文
Pass: 事実・条件・次の行動が分離されている
Fail: 事実と推測が混在している
Pass: Policy結果・reasonCode・nextActionの再定義がない
Fail: 用語の言い換えで意味が変わって見える
Pass: 例・列挙・チェックリストが説明用途に留まる
Fail: 例・列挙・チェックリストが実装テンプレに見える

CTA
Pass: 権限外の操作誘導が含まれない
Fail: 例外・裏口・overrideを示唆する
Pass: 行動の責任主体がユーザーにあることが明確
Fail: AIやシステムが判断主体に見える
Pass: 公式導線に戻る構造が維持されている
Fail: 公式導線を外れる誘導が含まれる

② UX事故パターン集（状態別）
状態1: openerが断定調で始まり、判断主体がAIに見える — 誤判断の責任が曖昧になる
状態2: 時間制約の強調が恐怖誘導に見える — 利用者の判断が歪む
状態3: 事実と条件の境界が曖昧 — 誤解が起きやすい
状態4: 背景説明が冗長で結論が埋もれる — 行動の迷いが増える
状態5: 最短導線が優先されすぎて根拠が省略される — 誤誘導に見える
状態6: 失敗や不確実性の扱いが曖昧 — 伝達責任が不明になる
状態7: 信頼確認の文面が断定的に見える — 誤信を誘発する

③ UX品質スコアカード（簡易）
配点（合計10点）
openerの主体明確性: 2点
本文の事実/条件分離: 2点
Policy/Matrix/SSOTの再定義回避: 2点
付録C依存の文言逸脱なし: 2点
CTAの権限・責任の明確性: 2点
合格ライン: 8点以上

## UX向上に寄与しうるAPI活用メモ（非仕様・判断補助）

本セクションは仕様ではない。
本セクションは SSOT / PolicyUxAdminMatrix / 各下位仕様を変更・補完・再定義しない。
本セクションは UX設計および将来検討時の思考補助のみを目的とし、拘束力・要件性・合意事項性を持たない。

1) 位置づけ
	•	本メモで言う「API」とは、外部/内部を問わず、データ取得・更新・同期・照会・生成に関わる接続点を指す。
	•	本メモは、APIの導入可否・優先順位・実装方法を決定するものではない。
	•	記載内容は、検討時に論点を想起するための整理であり、結論を導くものではない。

2) APIがUXに影響しうる主要論点（観点カタログ）

A. 正確性・信頼感に影響しうる領域
	•	公式性（一次情報か、二次集約か）
	•	更新遅延（更新頻度・反映タイムラグ）
	•	地域差（州・学区・自治体差、同名組織の混同）
	•	表記差（言語/日付/時差/祝日定義の差）

B. 入力負荷・継続率に影響しうる領域
	•	初回入力の削減余地（候補提示、補完的取得）
	•	再入力の削減余地（同期・差分反映・変更検知）
	•	誤取得時の巻き戻し容易性（情報の出所追跡性）

C. 先回り・安心感に影響しうる領域
	•	近接イベントの自動検知（休校/遅延、締切、当日持ち物など）
	•	“次の一手”の提示（公式導線の提示、やることの棚卸し）
	•	異常時の解像度（根拠、更新日時、参照元の明示）

D. コスト・安全性・運用負荷に影響しうる領域
	•	呼び出し回数の増減（ピーク、再試行、重複）
	•	失敗時の挙動（タイムアウト、部分失敗、代替提示）
	•	個人情報の接触面（送信・保存・ログのどこに触れるか）
	•	監査可能性（いつ/どこから/何を根拠に提示したか）

3) “具体化”のための整理（非手順・地図）

下表は、UX上の違和感とAPI観点の関係を俯瞰するための整理であり、実装・変更の指示ではない。

UXで起きがちな違和感	関連しうるAPI観点	事後に見たい観測の例（判断材料）
情報が古い/ズレている	更新遅延・公式性・地域差	参照元、取得日時、差分頻度、誤報率の傾向
入力が面倒で離脱	入力負荷・同期	初回入力量、再入力回数、途中離脱の傾向
根拠が分かりにくい	追跡性・監査可能性	根拠提示率、問い合わせ理由の傾向
例外時に弱い	部分失敗・フォールバック	失敗率、復旧時間、代替提示の有無
個人情報が不安	接触面・ログ	PII接触点の棚卸し、ログ残存範囲

4) 誤読防止（安全ピン）
	•	本記載を根拠に、API追加・仕様変更・実装判断・運用判断を行わない。
	•	実装や仕様の変更が関係する場合は、SSOT側の改定として別途扱う。
	•	本メモは、将来の議論で論点を復元するために保持される。

## UX状態 × API活用 対応マップ（非仕様・判断補助）

本セクションは仕様ではない。
本セクションは SSOT / PolicyUxAdminMatrix / UX_STATE_MAP_7 / 各下位仕様を変更・補完・再定義しない。
本セクションは、UX設計および将来検討時の思考補助のみを目的とし、拘束力・要件性・合意事項性を持たない。

位置づけ
	•	本マップは、UX状態を起点に「どのAPI観点が関係しうるか」を俯瞰するための整理である。
	•	APIの導入可否・優先順位・実装方法を決めるものではない。

※ 状態名は UX_STATE_MAP_7 に依存し、説明・再定義は行わない。

UX状態別：関連しうるAPI観点（地図）

状態1（初期／不確実性が高い）
	•	関連しうる観点
	•	正確性（公式性・更新日）
	•	根拠提示（参照元URL、取得日時）
	•	観測したい兆候（判断材料）
	•	「本当に合っているか？」という問い合わせの頻度

状態2（確認・照会）
	•	関連しうる観点
	•	検索・取得系（一次情報への直リンク）
	•	表記差・地域差の吸収
	•	観測したい兆候
	•	再確認質問、同義質問の発生率

状態3（条件付き・分岐）
	•	関連しうる観点
	•	条件データの粒度
	•	差分検知（条件が変わったときの再通知）
	•	観測したい兆候
	•	条件の誤解による差し戻し

状態4（行動検討）
	•	関連しうる観点
	•	次の一手提示（公式導線）
	•	関連イベント・締切の近接検知
	•	観測したい兆候
	•	「次に何をすれば？」という質問

状態5（進行中）
	•	関連しうる観点
	•	進捗・ステータス取得
	•	カレンダー同期・リマインド
	•	観測したい兆候
	•	期限直前の再質問

状態6（失敗・不確実性の顕在化）
	•	関連しうる観点
	•	失敗理由の可視化
	•	フォールバック情報（代替公式情報）
	•	観測したい兆候
	•	クレーム／不信表明の兆候

状態7（完了・確認）
	•	関連しうる観点
	•	記録・再参照（いつ・何を根拠に完了したか）
	•	再発防止のための差分監視
	•	観測したい兆候
	•	後日「もう一度教えて」の発生

誤読防止（安全ピン）
	•	本マップを根拠に、API追加・仕様変更・実装判断を行わない。
	•	本マップは、UX状態→論点の想起にのみ用いる。
	•	実装や変更が必要な場合は、SSOT側の改定プロセスを別途要する。

## 結論

- 派生ガイド群は `Guides.md` に統合し、参照導線を一本化する。
- 仕様追加・判断はSSOTへ戻し、未確定は隔離→`Todo.md`で停止する。

---

## 補足

### 差分サマリ（本ファイル）

- **追加**: `Guides.md`（派生ガイド群の統合）
- **削除**: 統合元ファイル（参照導線を本ファイルへ集約）

---

## 矛盾候補（隔離）

- 旧ファイルに存在していた未確定論点（Vendor/Experience Source/RAES/IRS 等）は、SSOT確定が必要なため本文に入れない。必要なら `Todo.md` に根拠SSOT箇所とともに起票して停止する。
